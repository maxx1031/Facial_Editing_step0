openai:
  model: gpt-4o
  api_key: ${OPENAI_API_KEY}   # optional: only needed when using --backend gpt
  max_retries: 3
  timeout: 60

generation:
  # FLUX.2-klein-4B: Apache 2.0, ~8GB VRAM, 4-step inference
  model_id: black-forest-labs/FLUX.2-klein-4B
  pipeline_class: Flux2Pipeline         # 使用 DiffusionPipeline 自动加载
  hf_token: ${HF_TOKEN}                 # optional for 4B Apache variant
  width: 1056
  height: 528
  num_steps: 4             # FLUX.2-klein is optimized for 4-step inference
  guidance_scale: 1.0      # FLUX.2-klein recommended guidance_scale
  seeds_per_pair: 5
  max_sequence_length: 512
  device: cuda

scale:
  num_persons: 50          # validation phase; scale to 2000-3000 later
  emotion_pairs_per_person: 3  # validation phase; scale to 5-8 later

filtering:
  arcface_threshold: 0.5
  require_exact_one_face: true
  face_det_score_threshold: 0.5
  emotion_model: enet_b0_8_best_afew  # HSEmotion model variant

paths:
  data_dir: data
  prompts_file: data/prompts.jsonl
  raw_dir: data/raw
  cropped_dir: data/cropped
  filtered_dir: data/filtered
  dataset_dir: data/dataset
  filter_stats: data/filter_stats.json
  metadata_file: data/raw/metadata.jsonl
  # v2 pipeline paths
  reference_pool_dir: data/reference_pool
  reference_pool_metadata: data/reference_pool/pool_metadata.jsonl
  triplets_dir: data/triplets
  triplets_metadata: data/triplets/triplet_metadata.jsonl
  dataset_v2_dir: data/dataset_v2

emotions:
  - neutral
  - happy
  - sad
  - angry
  - surprised
  - fearful
  - disgusted
  - contempt

# v2 reference pool settings
reference_pool:
  flux_per_expression: 500       # I_r images per expression (used by InfiniteYou generation)
  min_face_area_frac: 0.10
  emotion_conf_threshold: 0.55
  k_ir_per_pair: 3               # how many I_r to sample per (I_e, I_e_edit) pair

# InfiniteYou settings (for step5 reference pool generation)
infiniteyou:
  infiniteyou_path: /scratch/GenAI_class/f007yzf/InfiniteYou
  base_model_path: black-forest-labs/FLUX.1-dev
  model_dir: ByteDance/InfiniteYou
  infu_flux_version: v1.0
  model_version: aes_stage2
  width: 512
  height: 512
  guidance_scale: 3.5
  num_steps: 30
  infusenet_conditioning_scale: 1.2
  infusenet_guidance_start: 0.0
  infusenet_guidance_end: 1.0

# Emotion pairs to generate (source_emotion -> target_emotion)
emotion_pairs:
  - [neutral, happy]
  - [neutral, sad]
  - [neutral, angry]
  - [neutral, surprised]
  - [neutral, fearful]
  - [neutral, disgusted]
  - [happy, sad]
  - [happy, angry]
  - [happy, surprised]
  - [sad, angry]
